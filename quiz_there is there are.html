<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº’å‹•å¼å½±ç‰‡æ¸¬é©—ï¼šThere is/are (å³æ™‚æš«åœç‰ˆ)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* ä½¿ç”¨ Inter å­—é«”ä¸¦ç¢ºä¿å…¨è¢å¹•é«˜åº¦ */
        body {
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
            background-color: #f7f9fc;
        }

        /* å½±ç‰‡ 16:9 éŸ¿æ‡‰å¼å®¹å™¨ */
        .video-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            padding-bottom: 56.25%; /* 16:9 Aspect Ratio */
            height: 0;
            overflow: hidden;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            border-radius: 1rem;
            background-color: #000;
        }

        #player {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        /* æ¸¬é©—å½ˆçª—/æ‡¸æµ®å€å¡Š */
        #quiz-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.75); /* åŠé€æ˜é®ç½© */
            z-index: 10;
            display: flex;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }

        .quiz-card {
            background: white;
            padding: 1.5rem;
            border-radius: 1rem;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
            max-width: 90%;
            width: 450px;
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }

        .option-btn {
            transition: all 0.2s;
        }

        .option-btn:hover:not(:disabled) {
            background-color: #e5e7eb;
        }

        .correct-answer {
            background-color: #D1FAE5 !important; /* Green 100 */
            border-color: #10B981 !important; /* Green 500 */
            color: #065F46 !important;
            font-weight: 700;
        }

        .wrong-answer {
            background-color: #FEE2E2 !important; /* Red 100 */
            border-color: #F87171 !important; /* Red 400 */
            color: #991B1B !important;
            font-weight: 700;
        }

        /* å¡«ç©ºé¡Œæ¨£å¼ */
        .fill-in-input {
            padding: 0.5rem;
            border-radius: 0.5rem;
            border: 2px solid #D1D5DB; 
            width: 100%;
            transition: border-color 0.2s;
        }
        .fill-in-input:focus {
            outline: none;
            border-color: #3B82F6; 
        }

    </style>
</head>
<body class="p-4 sm:p-8">

    <header class="text-center mb-8">
        <h1 class="text-3xl font-extrabold text-blue-700">ğŸ“½ï¸ äº’å‹•å¼å½±ç‰‡æ¸¬é©—ï¼šThere is/are</h1>
        <p class="text-gray-600 mt-2">å½±ç‰‡å°‡åœ¨é—œéµèªæ³•é»è‡ªå‹•æš«åœï¼Œè«‹å›ç­”å•é¡Œå¾Œå†ç¹¼çºŒæ’­æ”¾ã€‚</p>
        <p class="text-lg font-bold mt-2 text-gray-800" id="current-score">
            ç•¶å‰åˆ†æ•¸ï¼š<span id="score-display" class="text-green-600">0</span> / 9
        </p>
    </header>

    <!-- å½±ç‰‡æ’­æ”¾å™¨å®¹å™¨ -->
    <div class="video-container">
        <!-- YouTube IFrame Player API å°‡åœ¨æ­¤è™•æ’å…¥æ’­æ”¾å™¨ -->
        <div id="player"></div>

        <!-- æ¸¬é©—å½ˆçª— -->
        <div id="quiz-overlay" class="hidden">
            <div class="quiz-card" id="quiz-card-content">
                <!-- æ¸¬é©—å…§å®¹å°‡ç”± JavaScript å¡«å…… -->
                <p class="text-xl font-bold mb-4 text-blue-600" id="quiz-question"></p>
                
                <div id="quiz-options" class="space-y-3 mb-4">
                    <!-- é¸é …/è¼¸å…¥æ¡†å°‡åœ¨æ­¤è™• -->
                </div>

                <div id="quiz-feedback" class="hidden p-3 rounded-lg text-sm mb-4">
                    <p id="feedback-message" class="font-semibold"></p>
                    <p id="rationale-message" class="mt-1 text-xs"></p>
                </div>
                
                <button id="resume-btn" class="w-full py-3 bg-red-600 text-white font-bold rounded-lg shadow-md hover:bg-red-700 transition-colors duration-200 focus:outline-none focus:ring-4 focus:ring-red-300">
                    ç¹¼çºŒæ’­æ”¾å½±ç‰‡
                </button>
            </div>
        </div>
    </div>

    <script>
        // 1. YouTube API åŠ è¼‰
        let player;
        let isQuizActive = false;
        let currentQuizIndex = -1;
        let userScore = 0;
        const scoreDisplay = document.getElementById('score-display');
        const overlay = document.getElementById('quiz-overlay');
        const quizQuestionEl = document.getElementById('quiz-question');
        const quizOptionsEl = document.getElementById('quiz-options');
        const feedbackContainer = document.getElementById('quiz-feedback');
        const feedbackMessageEl = document.getElementById('feedback-message');
        const rationaleMessageEl = document.getElementById('rationale-message');
        const resumeBtn = document.getElementById('resume-btn');
        
        // æ¸¬é©—å•é¡Œæ•¸æ“š
        const QUIZ_DATA = [
            { id: 0, time: 35, type: 'choice', 
              question: '1. There ___ a problem. (å–®æ•¸)', 
              options: ['is', 'are'], correct: 'is', rationale: 'å–®æ•¸åè© (a problem) å‰è¦ç”¨ã€Œisã€ã€‚' 
            },
            { id: 1, time: 55, type: 'choice', 
              question: '2. There ___ many problems. (è¤‡æ•¸)', 
              options: ['is', 'are'], correct: 'are', rationale: 'è¤‡æ•¸åè© (many problems) å‰è¦ç”¨ã€Œareã€ã€‚' 
            },
            { id: 2, time: 115, type: 'choice', 
              question: '3. [æ˜¯éé¡Œ] "There are a lot of water on the floor." é€™å¥è©±æ˜¯æ­£ç¢ºçš„ã€‚', 
              options: ['O (æ­£ç¢º)', 'X (éŒ¯èª¤)'], correct: 'X (éŒ¯èª¤)', rationale: 'ã€Œwaterã€æ˜¯ä¸å¯æ•¸åè©ï¼Œè¦–ç‚ºå–®æ•¸ï¼Œå‹•è©æ‡‰ç‚ºã€Œisã€ã€‚' 
            },
            { id: 3, time: 150, type: 'choice', 
              question: '4. There ___ some juice in the fridge. (ä¸å¯æ•¸)', 
              options: ['is', 'are'], correct: 'is', rationale: 'ã€Œjuiceã€æ˜¯ä¸å¯æ•¸åè©ï¼Œè¦ç”¨ã€Œisã€ã€‚' 
            },
            { id: 4, time: 265, type: 'choice', 
              question: '5. There ___ a gym. (å¦å®šå–®æ•¸)', 
              options: ["isn't", "aren't"], correct: "isn't", rationale: 'å–®æ•¸åè© (a gym) å¦å®šç”¨ã€Œisn\'tã€ã€‚' 
            },
            { id: 5, time: 305, type: 'fill-in', 
              question: '6. [å¡«ç©º] "There are not" çš„ç¸®å¯« (contraction) æ˜¯ä»€éº¼ï¼Ÿ', 
              correct: "aren't", rationale: 'ç¸®å¯«æ˜¯ã€Œaren\'tã€ã€‚' 
            },
            { id: 6, time: 320, type: 'choice', 
              question: '7. There ___ any pens on the table. (å¦å®šè¤‡æ•¸)', 
              options: ["isn't", "aren't"], correct: "aren't", rationale: 'è¤‡æ•¸åè© (any pens) å¦å®šç”¨ã€Œaren\'tã€ã€‚' 
            },
            { id: 7, time: 355, type: 'choice', 
              question: '8. There ___ any snow in Jamaica. (å¦å®šä¸å¯æ•¸)', 
              options: ["isn't", "aren't"], correct: "isn't", rationale: 'ä¸å¯æ•¸åè© (any snow) å¦å®šç”¨ã€Œisn\'tã€ã€‚' 
            },
            { id: 8, time: 420, type: 'fill-in', 
              question: '9. [å¡«ç©º] è«‹å°‡ "There are some books." æ”¹ç‚ºç–‘å•å¥ã€‚ (é–‹é ­å¤§å¯«)', 
              correct: "Are there any books?", rationale: 'ç–‘å•å¥å‹ç‚ºã€ŒAre there...any...?ã€ï¼Œæ³¨æ„è‚¯å®šå¥çš„ã€Œsomeã€è¦æ”¹ç‚ºã€Œanyã€ã€‚' 
            },
            // Q9 å½±ç‰‡æ™‚é–“é»å¤ªæ¥è¿‘ï¼Œå°‡ Q10 ä½œç‚ºæœ€å¾Œä¸€é¡Œ
            // { id: 9, time: 455, type: 'choice', question: '10. [æ˜¯éé¡Œ] A: "Are there any books?" B: "Yes, there is." é€™æ¨£çš„å›ç­”æ˜¯æ­£ç¢ºçš„ã€‚', options: ['O (æ­£ç¢º)', 'X (éŒ¯èª¤)'], correct: 'X (éŒ¯èª¤)', rationale: 'å•å¥ç”¨ã€ŒAre there...ã€(è¤‡æ•¸)ï¼Œå›ç­”å¿…é ˆç”¨ã€ŒYes, there are.ã€ã€‚' },
        ];
        
        // ----------------------------------------------------------------------
        // æ­¥é©Ÿ 1: è¼‰å…¥ YouTube IFrame Player API ç¨‹å¼ç¢¼
        const tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api";
        const firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

        // æ­¥é©Ÿ 2: API ç¨‹å¼ç¢¼ä¸‹è¼‰å®Œç•¢å¾Œï¼Œå‘¼å«æ­¤å‡½å¼å»ºç«‹æ’­æ”¾å™¨
        window.onYouTubeIframeAPIReady = function() {
            player = new YT.Player('player', {
                videoId: 'xCrsoRmPFok', // å½±ç‰‡ ID
                playerVars: {
                    'playsinline': 1,
                    'controls': 1,
                    'modestbranding': 1, // æ¸›å°‘æ§åˆ¶åˆ—çš„ YouTube æ¨™èªŒ
                    'rel': 0 // é—œé–‰ç›¸é—œå½±ç‰‡
                },
                events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange
                }
            });
        }

        function onPlayerReady(event) {
            // æ’­æ”¾å™¨æº–å‚™å¥½å¾Œï¼Œé–‹å§‹è¨ˆæ™‚ç›£è½
            setInterval(checkQuizTime, 100); // æ¯ 100 æ¯«ç§’æª¢æŸ¥ä¸€æ¬¡æ™‚é–“
        }
        
        // æ­¥é©Ÿ 3: ç›£è½æ’­æ”¾ç‹€æ…‹
        function onPlayerStateChange(event) {
            // 1: æ’­æ”¾ä¸­
            if (event.data === YT.PlayerState.PLAYING) {
                isQuizActive = false; // ç¢ºä¿åœ¨æ’­æ”¾æ™‚æ²’æœ‰æ¸¬é©—å½ˆçª—
            }
            // 2: æš«åœ
            else if (event.data === YT.PlayerState.PAUSED && !isQuizActive) {
                // å¦‚æœæ˜¯ä½¿ç”¨è€…è‡ªå·±æŒ‰æš«åœï¼Œä¸è™•ç†
            }
        }
        
        // æ­¥é©Ÿ 4: æª¢æŸ¥æ™‚é–“ä¸¦è§¸ç™¼æ¸¬é©—
        function checkQuizTime() {
            if (player && player.getPlayerState() === YT.PlayerState.PLAYING && !isQuizActive) {
                const currentTime = player.getCurrentTime();
                
                // æ‰¾å‡ºä¸‹ä¸€å€‹é‚„æ²’å®Œæˆçš„æ¸¬é©—é»
                const nextQuiz = QUIZ_DATA.find(q => q.id > currentQuizIndex);
                
                if (nextQuiz && currentTime >= nextQuiz.time) {
                    // é”åˆ°æ™‚é–“é»ï¼Œæš«åœå½±ç‰‡ä¸¦é¡¯ç¤ºæ¸¬é©—
                    player.pauseVideo();
                    currentQuizIndex = nextQuiz.id;
                    showQuiz(nextQuiz);
                }
            }
        }

        // æ­¥é©Ÿ 5: é¡¯ç¤ºæ¸¬é©—å…§å®¹
        function showQuiz(quizItem) {
            isQuizActive = true;
            
            // è¨­ç½®å•é¡Œæ¨™é¡Œ
            quizQuestionEl.textContent = `${quizItem.id + 1}. ${quizItem.question}`;
            
            // æ¸…ç©ºé¸é …å€å¡Š
            quizOptionsEl.innerHTML = '';
            
            // éš±è—å›é¥‹ã€ç¦ç”¨ç¹¼çºŒæŒ‰éˆ•
            feedbackContainer.classList.add('hidden');
            resumeBtn.disabled = true;
            resumeBtn.textContent = 'è«‹å…ˆå®Œæˆä½œç­”';
            resumeBtn.classList.remove('bg-green-600', 'hover:bg-green-700');
            resumeBtn.classList.add('bg-gray-400');
            
            // æ ¹æ“šé¡Œå‹æ¸²æŸ“é¸é …
            if (quizItem.type === 'choice') {
                quizItem.options.forEach(option => {
                    const btn = document.createElement('button');
                    btn.className = 'option-btn w-full py-3 px-4 border border-gray-300 rounded-lg text-left hover:bg-gray-50';
                    btn.textContent = option;
                    btn.setAttribute('data-value', option);
                    btn.onclick = () => checkChoiceAnswer(btn, quizItem);
                    quizOptionsEl.appendChild(btn);
                });
            } else if (quizItem.type === 'fill-in') {
                const inputContainer = document.createElement('div');
                inputContainer.className = 'flex flex-col space-y-2';
                
                const input = document.createElement('input');
                input.type = 'text';
                input.className = 'fill-in-input';
                input.placeholder = 'è«‹è¼¸å…¥ç­”æ¡ˆ...';
                input.id = 'fill-in-input';
                
                const checkBtn = document.createElement('button');
                checkBtn.className = 'py-3 bg-blue-600 text-white font-bold rounded-lg shadow-md hover:bg-blue-700 transition-colors';
                checkBtn.textContent = 'æª¢æŸ¥ç­”æ¡ˆ';
                checkBtn.onclick = () => checkFillInAnswer(input, quizItem);

                inputContainer.appendChild(input);
                inputContainer.appendChild(checkBtn);
                quizOptionsEl.appendChild(inputContainer);
            }

            // é¡¯ç¤ºå½ˆçª—
            overlay.classList.remove('hidden');
        }

        // æ­¥é©Ÿ 6: æª¢æŸ¥é¸æ“‡é¡Œç­”æ¡ˆ
        function checkChoiceAnswer(selectedBtn, quizItem) {
            // ç¦ç”¨æ‰€æœ‰æŒ‰éˆ•é˜²æ­¢é‡è¤‡é»æ“Š
            quizOptionsEl.querySelectorAll('.option-btn').forEach(btn => btn.disabled = true);

            const selectedValue = selectedBtn.getAttribute('data-value').toLowerCase().trim();
            const correctValue = quizItem.correct.toLowerCase().trim();
            const isCorrect = (selectedValue === correctValue);
            
            // é¡¯ç¤ºå›é¥‹
            showFeedback(quizItem, isCorrect);
            
            if (isCorrect) {
                userScore++;
                scoreDisplay.textContent = userScore;
                selectedBtn.classList.add('correct-answer');
            } else {
                selectedBtn.classList.add('wrong-answer');
                // æ¨™ç¤ºæ­£ç¢ºç­”æ¡ˆ
                quizOptionsEl.querySelector(`[data-value="${quizItem.correct}"]`).classList.add('correct-answer');
            }
            
            // å•Ÿç”¨ç¹¼çºŒæŒ‰éˆ•
            enableResumeButton();
        }

        // æ­¥é©Ÿ 7: æª¢æŸ¥å¡«ç©ºé¡Œç­”æ¡ˆ
        function checkFillInAnswer(inputElement, quizItem) {
            const userAnswer = inputElement.value.toLowerCase().trim().replace(/[\s.!?]/g, '');
            const correct = quizItem.correct.toLowerCase().trim().replace(/[\s.!?]/g, '');

            // ç”±æ–¼å¡«ç©ºé¡Œå¯èƒ½æœ‰å¤šç¨®åˆç†ç­”æ¡ˆï¼Œé€™è£¡åšä¸€äº›å¯¬é¬†è™•ç†
            let isCorrect = false;
            if (quizItem.id === 5) { // Q5: aren't
                isCorrect = (userAnswer === 'arent' || userAnswer === "aren't" || userAnswer === 'arenot');
            } else if (quizItem.id === 8) { // Q9: Are there any books?
                // æª¢æŸ¥æ˜¯å¦åŒ…å«é—œéµè©ï¼Œä¸¦ä»¥ Are/are é–‹é ­
                isCorrect = (userAnswer.includes('arethereanybooks') || userAnswer.includes('aretheresomebooks')); 
            } else {
                isCorrect = (userAnswer === correct);
            }

            // é¡¯ç¤ºå›é¥‹
            showFeedback(quizItem, isCorrect, quizItem.correct);
            
            if (isCorrect) {
                userScore++;
                scoreDisplay.textContent = userScore;
                inputElement.style.borderColor = '#10B981';
            } else {
                inputElement.style.borderColor = '#EF4444';
            }
            
            // å•Ÿç”¨ç¹¼çºŒæŒ‰éˆ•
            enableResumeButton();
            // ç¦ç”¨æª¢æŸ¥æŒ‰éˆ•
            inputElement.nextElementSibling.disabled = true; 
        }

        // æ­¥é©Ÿ 8: é¡¯ç¤ºå›é¥‹è¨Šæ¯
        function showFeedback(quizItem, isCorrect, displayedCorrectAnswer = quizItem.correct) {
            feedbackContainer.classList.remove('hidden');
            feedbackContainer.classList.remove('bg-red-100', 'bg-green-100');
            
            if (isCorrect) {
                feedbackContainer.classList.add('bg-green-100', 'text-green-800');
                feedbackMessageEl.textContent = 'âœ” ç­”å°äº†ï¼è§€å¿µæ­£ç¢ºï¼';
            } else {
                feedbackContainer.classList.add('bg-red-100', 'text-red-800');
                feedbackMessageEl.textContent = `âœ˜ ç­”éŒ¯äº†ã€‚æ­£ç¢ºç­”æ¡ˆæ˜¯ï¼šã€Œ${displayedCorrectAnswer}ã€`;
            }
            
            rationaleMessageEl.textContent = `èªæ³•è§£æï¼š${quizItem.rationale}`;
        }

        // æ­¥é©Ÿ 9: å•Ÿç”¨ç¹¼çºŒæŒ‰éˆ•
        function enableResumeButton() {
            resumeBtn.disabled = false;
            resumeBtn.textContent = 'ç¹¼çºŒæ’­æ”¾å½±ç‰‡ >>';
            resumeBtn.classList.add('bg-green-600', 'hover:bg-green-700');
            resumeBtn.classList.remove('bg-gray-400');
        }

        // æ­¥é©Ÿ 10: ç¹¼çºŒæ’­æ”¾
        resumeBtn.addEventListener('click', () => {
            if (currentQuizIndex === QUIZ_DATA.length - 1) {
                // æœ€å¾Œä¸€é¡Œï¼Œé¡¯ç¤ºæœ€çµ‚å¾—åˆ†
                alert(`æ­å–œæ‚¨å®Œæˆæ¸¬é©—ï¼æ‚¨çš„æœ€çµ‚å¾—åˆ†ç‚º ${userScore} / ${QUIZ_DATA.length}ã€‚è«‹å°‡æ­¤ç•«é¢æˆªåœ–ç¹³äº¤ã€‚`);
            }
            
            overlay.classList.add('hidden');
            isQuizActive = false;
            player.playVideo();
        });

    </script>
</body>
</html>
